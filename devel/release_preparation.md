# Release Preparation for the Control Package

## Set version number etc.

1. Merge branch `default` into branch `release_preparation`
2. Update `NEWS`, possibly move old entries into `ONEWS`
3. Update version in `DESCRIPTION`
4. Update version in `src/configure.ac`
5. Update `INDEX` if a new function was added
5. `git commit` for storing above changes

## Testing

6. `make distclean` for removing all old distribution files
4. Tests
    1. `make dist`
    2. `pkg install target/control-X.Y.Z.tar.gz` in Octave
        - any warnings or even errors?
        - correct version number?
    3. `pkg test control` in Octave
    4. `pkg uninstall control` in Octave
    5. `make install`
        - any warnings or even errors?
        - correct version number?
    6. `pkg test control` in Octave

## Release the package

Releasing the package should be done in the *release* branch as github will deploy the html-documentation in the directory `docs` from the *release* branch.

1. `git checkout release`
2. `git merge main`
5. `make release`<br>
   *Alternatively*, this can be done by the following separate commands
    1. `make dist`
    4. `sha256sum target/control-X.Y.Z.tar.gz`
    1. `make install`
    2. `make docs` (this should be done with an active internet connection as this process tries to determine the url to the function's source on github and add it to the function reference)
3. `git commit` (atleast the new docs)
4. `git tag control-X.Y.Z`
5. `git push` (docs should be automatically be published by github)
6. `git push origin control-X.Y.Z` (push the tag) 
5. Make release on github (see below: *Publishing the release*)
6. Update `control.yaml`
    1. update in the repository `gnu-octave/packages`
    2. create a pull request
    3. merge pull request after all tests have passed
9. `git checkout main`
10. `git merge release`
11. `git checkout dev`
12. `git merge main`


## Configuration of the repository on github

### Deployment of package documentation

For automatically publishing the html documentation (generated by the package *pkg-octave-doc* in directory `docs`) at [github.io](https://gnu-octave.github.io/pkg-control/), the [github repository](https://github.com/gnu-octave/pkg-control) is configured by the following steps:

1. *Settings*
2. *Pages* in *Code and automation*
3. Source: *Deploy from a branch*
4. Branch: *release* */docs*
5. *Save*

The deployment is based on the *release* branch for not triggering the deployment of intermediate (non-release) versions by pushing changes in the *main* branch.

### Publishing the Release

This is not done by just tagging and making the tarball of the repository as parts of the repository should not be contained in the downloadable package, like, e.g., the directories `devel` and `docs`). All excluded files and directory can be found in `.gitattributes` wiht the attribute `export-ignore`.

The release is created manually [on github](https://github.com/gnu-octave/pkg-control) by following steps:

1. *Releases*
2. *Draft new release*
3. *Choose a tag* and select the desired tag `control-X.Y.Z`
3. Upload `control-X.Y.Z.tar.gz` as binary file
4. *Publish release*
