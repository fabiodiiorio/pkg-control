[TOC]

# Maintaining the Control Package

##Release Preparation for the Control Package

### Set version number etc.

2. [ ] Update `NEWS`, possibly move old entries into `ONEWS`
3. [ ] Update version in `DESCRIPTION`
4. [ ] Update version in `src/configure.ac`
5. [ ] Update `INDEX` if a new function was added
5. [ ] `git commit` for storing above changes

### Testing

After finishing the last changes for the planned release, the following tests should still be performed in the current branch (dev, main, or a specific feature branch). 

6. [ ] `make distclean` for removing all old distribution files
4. [ ] Tests
    1. [ ] `make dist`
    2. [ ] `pkg install target/control-X.Y.Z.tar.gz` in Octave
        - any warnings or even errors?
        - correct version number?
    3. [ ] `pkg test control` in Octave
    4. [ ] `pkg uninstall control` in Octave
    5. [ ] `make install`
        - any warnings or even errors?
        - correct version number?
    6. [ ] `pkg test control` in Octave

### Release the package

Releasing the package should be done in the *release* branch as github will deploy the html-documentation in the directory `docs` from the *release* branch.

1. [ ] Merge branch `main` (or the branch in which development and testing were carried out) into branch `release`
5. [ ] `make release`<br>
   *Alternatively*, this can be done by the following separate commands
    1. [ ] `make dist`
    1. [ ] `make install`
    2. [ ] `make docs` (this should be done with an active internet connection as this process tries to determine the url to the function's source on github and add it to the function reference)
    4. [ ] `sha256sum target/control-X.Y.Z.tar.gz`
3. [ ] `git commit` (at least the new docs)
4. [ ] `git tag control-X.Y.Z`
5. [ ] `git push origin release:release` (docs should be automatically be published by github)
6. [ ] `git push origin control-X.Y.Z` (push the tag) 
5. [ ] Make release on github (see below: *Publishing the release*)
6. [ ] Update `control.yaml`
    1. [ ] update in repository forked from `gnu-octave/packages` (update fork before)
    2. [ ] create a pull request (tests are starting automatically)
    3. [ ] merge pull request after all tests have successfully passed and add the label *package release*
9. [ ] `git checkout main`
10. [ ] `git merge release`
11. [ ] `git checkout dev`
12. [ ] `git merge main`


## Configuration of the repository on github

### Publishing the Release

This is not done by just tagging and making the tarball of the repository as parts of the repository should not be contained in the downloadable package, like, e.g., the directories `devel` and `docs`). All excluded files and directory can be found in `.gitattributes` wiht the attribute `export-ignore`.

The release is created manually [on github](https://github.com/gnu-octave/pkg-control) by following steps:

1. [ ] *Releases*
2. [ ] *Draft new release*
3. [ ] *Choose a tag* and select the desired tag `control-X.Y.Z`
4. [ ] Add description of most important changes and the following note regarding the assets automatically added by github:
    - **Please note:** The source archives  _Source code (zip)_ and _Source code (tar.gz)_ are automatically added to the release's assets by Github and do **not** contain the complete sources since this project uses submodules for the SLICOT library. All sources that are required for installing the control package in GNU Octave are included in the downloadable archive file _control-x.y.z.tar.gz_. The complete sources (including, e.g., the ones for packaging) are available in the repository which has to be cloned using the option `--recurse-submodules`. 
3. [ ] Upload `control-X.Y.Z.tar.gz` as binary file
4. [ ] *Publish release*

### Deployment of package documentation

For automatically publishing the html documentation (generated by the package *pkg-octave-doc* in directory `docs`) at [github.io](https://gnu-octave.github.io/pkg-control/), the [github repository](https://github.com/gnu-octave/pkg-control) is configured by the following steps:

1. [x] *Settings*
2. [x] *Pages* in *Code and automation*
3. [x] Source: *Deploy from a branch*
4. [x] Branch: *release* */docs*
5. [x] *Save*

The deployment is based on the *release* branch for not triggering the deployment of intermediate (non-release) versions by pushing changes in the *main* branch.

